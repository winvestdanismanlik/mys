<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormZen - Bitkisel Gıda Ürünleri Kar/Zarar Hesaplama Programı</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        .company-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
            color: #e8f5e9;
        }
        
        .company-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 15px;
            color: #c8e6c9;
        }
        
        h1 {
            margin: 10px 0 0 0;
            font-size: 28px;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
        }
        
        .input-section {
            flex: 1;
            min-width: 400px;
            padding: 20px;
            border-right: 1px solid #eee;
        }
        
        .result-section {
            flex: 1;
            min-width: 400px;
            padding: 20px;
            background-color: #f9fafc;
        }
        
        .advanced-section {
            width: 100%;
            padding: 20px;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }
        
        .campaign-section {
            width: 100%;
            padding: 20px;
            border-top: 1px solid #eee;
            margin-top: 20px;
            background-color: #f8f9ff;
            border-radius: 8px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        .label-info {
            font-size: 12px;
            color: #666;
            font-weight: normal;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            transform: scale(1.2);
        }
        
        .campaign-inputs {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        
        .campaign-example {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        .cost-summary {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }
        
        .cost-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px dashed #eee;
        }
        
        .cost-title {
            font-weight: 500;
        }
        
        .cost-value {
            font-weight: 600;
        }
        
        .cost-sub-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-left: 15px;
            font-size: 14px;
        }
        
        .sub-item-title {
            color: #666;
        }
        
        .total-profit {
            background: #f0f9ff;
            border: 2px solid #b8e1ff;
            border-radius: 8px;
            padding: 25px;
            margin-top: 25px;
            text-align: center;
        }
        
        .profit-positive {
            color: #10b981;
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .profit-negative {
            color: #ef4444;
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .profit-neutral {
            color: #6b7280;
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .profit-margin {
            font-size: 18px;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .campaign-info {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .campaign-info.active {
            display: block;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .calculate-btn {
            background: linear-gradient(to right, #2e7d32, #4caf50);
            color: white;
        }
        
        .calculate-btn:hover {
            background: linear-gradient(to right, #1b5e20, #388e3c);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .reset-btn {
            background: #f3f4f6;
            color: #4b5563;
            border: 1px solid #d1d5db;
        }
        
        .reset-btn:hover {
            background: #e5e7eb;
        }
        
        .history-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .history-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .clear-history {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 14px;
            padding: 5px 10px;
        }
        
        .history-item {
            background: white;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #4caf50;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .history-product {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .history-platform {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .history-profit {
            font-weight: 600;
            float: right;
            font-size: 18px;
        }
        
        .profit-positive-sm {
            color: #10b981;
        }
        
        .profit-negative-sm {
            color: #ef4444;
        }
        
        .section-title {
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            color: #444;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
        
        .toggle-advanced {
            background: none;
            border: none;
            color: #4caf50;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tax-info {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .influencer-section {
            background: #f0f7ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #d1e3ff;
        }
        
        .calculation-breakdown {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .breakdown-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #444;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .platform-service {
            background: #fff3e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #ffcc80;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid #ef5350;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="company-title">FORMZEN BİTKİSEL GIDA ÜRÜNLERİ</div>
            <div class="company-subtitle">Sağlıklı Yaşam, Doğal Ürünler</div>
            <h1>E-Ticaret Kar/Zarar Hesaplama Programı</h1>
        </header>
        
        <div class="content">
            <div class="input-section">
                <div class="section-title">Temel Bilgiler</div>
                
                <div class="error-message" id="errorMessage"></div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productName">Ürün Adı</label>
                        <input type="text" id="productName" placeholder="Örn: FormZen Chia Tohumu">
                    </div>
                    
                    <div class="form-group">
                        <label for="platform">Platform</label>
                        <select id="platform">
                            <option value="trendyol">Trendyol</option>
                            <option value="hepsiburada">Hepsiburada</option>
                            <option value="n11">N11</option>
                            <option value="amazon">Amazon</option>
                            <option value="digeryer">Diğer</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="quantity">Satılacak Toplam Ürün Adedi</label>
                        <input type="number" id="quantity" placeholder="Örn: 100" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="salePrice">Birim Satış Fiyatı (₺)</label>
                        <input type="number" id="salePrice" placeholder="Örn: 149.99" min="0" step="0.01">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productCost">Birim Ürün Maliyeti (₺)</label>
                        <input type="number" id="productCost" placeholder="Örn: 75.00" min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="commission">Platform Komisyonu (%)</label>
                        <input type="number" id="commission" placeholder="Otomatik hesaplanır" min="0" max="100" step="0.1">
                    </div>
                </div>
                
                <div class="campaign-section">
                    <div class="section-title">Kampanya Ayarları</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="enableCampaign">
                        <label for="enableCampaign">Kampanyalı Satış Aktif (3 al 2 öde gibi)</label>
                    </div>
                    
                    <div id="campaignInputs" class="campaign-inputs">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="campaignBuy">Kaç Ürün Alınıyor? (Alınan)</label>
                                <input type="number" id="campaignBuy" placeholder="Örn: 3" min="1" value="3">
                                <div class="campaign-example">Müşteri kampanyada kaç ürün alıyor?</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="campaignPay">Kaç Ürün Ödeniyor? (Ödenen)</label>
                                <input type="number" id="campaignPay" placeholder="Örn: 2" min="1" value="2">
                                <div class="campaign-example">Alınan ürünlerden kaç tanesi için ödeme yapılıyor?</div>
                            </div>
                        </div>
                        
                        <div class="campaign-info" id="campaignCalculation">
                            Kampanya Detayı: <span id="campaignDetails"></span>
                        </div>
                    </div>
                </div>
                
                <div class="influencer-section">
                    <div class="section-title">Influencer Komisyonu</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="enableInfluencer">
                        <label for="enableInfluencer">Influencer Komisyonu Aktif</label>
                    </div>
                    
                    <div id="influencerInputs" class="campaign-inputs">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="influencerCommission">Influencer Komisyon Oranı (%)</label>
                                <input type="number" id="influencerCommission" placeholder="Örn: 10" min="0" max="100" step="0.1" value="10">
                                <div class="campaign-example">Satış fiyatı üzerinden yüzde olarak komisyon (tüm satışlar için)</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="toggle-advanced" id="toggleAdvanced">
                    <span id="toggleText">▼ Diğer Maliyetleri Göster</span>
                </button>
                
                <div class="advanced-section" id="advancedSection" style="display: none;">
                    <div class="section-title">Diğer Maliyetler</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="labelCost">Etiket Maliyeti (birim) (₺)</label>
                            <input type="number" id="labelCost" placeholder="Örn: 0.50" min="0" step="0.01" value="0.50">
                        </div>
                        
                        <div class="form-group">
                            <label for="packagingCost">Paketleme Maliyeti (birim) (₺)</label>
                            <input type="number" id="packagingCost" placeholder="Örn: 2.00" min="0" step="0.01" value="2.00">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shippingCost">Kargo Maliyeti (toplam) (₺)</label>
                            <input type="number" id="shippingCost" placeholder="Örn: 15.00" min="0" step="0.01" value="15.00">
                            <span class="label-info">Toplam sipariş için tek seferlik</span>
                        </div>
                        
                        <div class="form-group">
                            <label for="adCost">Reklam Gideri (toplam) (₺)</label>
                            <input type="number" id="adCost" placeholder="Örn: 50.00" min="0" step="0.01" value="0.00">
                            <span class="label-info">Toplam sipariş için (influencer hariç)</span>
                        </div>
                    </div>
                    
                    <div class="platform-service">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="platformServiceFee">Platform Hizmet Bedeli (₺)</label>
                                <input type="number" id="platformServiceFee" placeholder="Örn: 100.00" min="0" step="0.01" value="0.00">
                                <span class="label-info">Aylık/tek seferlik platform hizmet bedeli (adetten bağımsız)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="kdvRate">KDV Oranı (%)</label>
                            <select id="kdvRate">
                                <option value="1" selected>%1 (Bitkisel Gıda Ürünleri)</option>
                                <option value="8">%8 (Temel İhtiyaç)</option>
                                <option value="18">%18 (Genel Oran)</option>
                                <option value="20">%20 (Lüks Ürünler)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="stopajRate">Stopaj Oranı (%)</label>
                            <input type="number" id="stopajRate" placeholder="Örn: 10" min="0" max="100" step="0.1" value="10">
                            <span class="label-info">KDV'siz satış fiyatı üzerinden</span>
                        </div>
                    </div>
                    
                    <div class="tax-info">
                        <strong>Vergi Bilgisi:</strong> Bitkisel gıda ürünleri için %1 KDV uygulanır. Stopaj, KDV'siz satış fiyatı üzerinden hesaplanır. Platform komisyonu KDV dahil fiyat üzerinden alınır. Influencer komisyonu satış fiyatı üzerinden tüm satışlar için hesaplanır.
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="calculate-btn" id="calculateBtn">Hesapla</button>
                    <button class="reset-btn" id="resetBtn">Temizle</button>
                </div>
            </div>
            
            <div class="result-section">
                <div class="section-title">Kar/Zarar Analizi</div>
                
                <div id="resultDetails">
                    <p>Lütfen ürün bilgilerini girin ve "Hesapla" butonuna tıklayın.</p>
                </div>
                
                <div class="calculation-breakdown" id="breakdownSection" style="display:none;">
                    <div class="breakdown-title">Kampanya Hesaplama Detayları</div>
                    <div id="breakdownDetails"></div>
                </div>
                
                <div id="profitResult" class="total-profit" style="display:none;">
                    <div style="font-size: 18px; font-weight: 600;">Net Kar/Zarar (Toplam)</div>
                    <div id="profitAmount" class="profit-neutral">₺0.00</div>
                    <div class="profit-margin">Kar Marjı: <span id="profitMargin">%0.00</span></div>
                    <div style="margin-top: 15px; font-size: 16px;">
                        <div>Birim Başına Ortalama Kar: <span id="unitProfit">₺0.00</span></div>
                        <div>Toplam Gelir (KDV Dahil): <span id="totalWithKdv">₺0.00</span></div>
                        <div>Etkili Birim Satış Fiyatı: <span id="effectivePrice">₺0.00</span></div>
                    </div>
                </div>
                
                <div class="history-section">
                    <div class="history-title">
                        <span>Hesaplama Geçmişi</span>
                        <button class="clear-history" id="clearHistory">Geçmişi Temizle</button>
                    </div>
                    <div id="historyList">
                        <p>Henüz hesaplama yapılmadı.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Platforma göre varsayılan komisyon oranları
        const platformCommissions = {
            trendyol: 18,
            hepsiburada: 20,
            n11: 15,
            amazon: 25,
            digeryer: 10
        };

        // DOM elementlerini seç
        const platformSelect = document.getElementById('platform');
        const commissionInput = document.getElementById('commission');
        const toggleAdvanced = document.getElementById('toggleAdvanced');
        const toggleText = document.getElementById('toggleText');
        const advancedSection = document.getElementById('advancedSection');
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const clearHistoryBtn = document.getElementById('clearHistory');
        const errorMessage = document.getElementById('errorMessage');
        
        // Kampanya elementleri
        const enableCampaignCheckbox = document.getElementById('enableCampaign');
        const campaignInputs = document.getElementById('campaignInputs');
        const campaignBuyInput = document.getElementById('campaignBuy');
        const campaignPayInput = document.getElementById('campaignPay');
        const campaignDetails = document.getElementById('campaignDetails');
        const campaignCalculation = document.getElementById('campaignCalculation');
        
        // Influencer elementleri
        const enableInfluencerCheckbox = document.getElementById('enableInfluencer');
        const influencerInputs = document.getElementById('influencerInputs');
        const influencerCommissionInput = document.getElementById('influencerCommission');

        // Platform seçildiğinde komisyon oranını otomatik doldur
        platformSelect.addEventListener('change', function() {
            const platform = this.value;
            
            if (platform in platformCommissions) {
                commissionInput.value = platformCommissions[platform];
            } else {
                commissionInput.value = '';
            }
        });

        // Kampanya checkbox'ını dinle
        enableCampaignCheckbox.addEventListener('change', function() {
            if (this.checked) {
                campaignInputs.style.display = 'block';
                campaignCalculation.style.display = 'block';
                updateCampaignDetails();
            } else {
                campaignInputs.style.display = 'none';
                campaignCalculation.style.display = 'none';
            }
        });

        // Influencer checkbox'ını dinle
        enableInfluencerCheckbox.addEventListener('change', function() {
            if (this.checked) {
                influencerInputs.style.display = 'block';
            } else {
                influencerInputs.style.display = 'none';
            }
        });

        // Kampanya detaylarını güncelle
        function updateCampaignDetails() {
            const buy = parseInt(campaignBuyInput.value) || 3;
            const pay = parseInt(campaignPayInput.value) || 2;
            
            if (buy > 0 && pay > 0 && pay <= buy) {
                const discount = ((buy - pay) / buy * 100).toFixed(1);
                campaignDetails.textContent = `${buy} al ${pay} öde (≈%${discount} indirim) - Ürün maliyeti ${buy} adet, gelir ${pay} adet üzerinden hesaplanır`;
            }
        }

        // Kampanya inputlarını dinle
        campaignBuyInput.addEventListener('input', updateCampaignDetails);
        campaignPayInput.addEventListener('input', updateCampaignDetails);

        // Gelişmiş maliyetleri gösterme/gizleme
        toggleAdvanced.addEventListener('click', function() {
            if (advancedSection.style.display === 'none') {
                advancedSection.style.display = 'block';
                toggleText.textContent = '▲ Diğer Maliyetleri Gizle';
            } else {
                advancedSection.style.display = 'none';
                toggleText.textContent = '▼ Diğer Maliyetleri Göster';
            }
        });

        // Hesapla butonu işlevi
        calculateBtn.addEventListener('click', function() {
            calculateProfit();
        });

        // Enter tuşu ile hesaplama
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                calculateProfit();
            }
        });

        // Temizle butonu işlevi
        resetBtn.addEventListener('click', function() {
            resetForm();
        });

        // Geçmişi temizle butonu
        clearHistoryBtn.addEventListener('click', function() {
            clearHistory();
        });

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        function calculateProfit() {
            // Temel değerleri al
            const productName = document.getElementById('productName').value || 'Ürün';
            const platform = platformSelect.options[platformSelect.selectedIndex].text;
            const totalQuantity = parseInt(document.getElementById('quantity').value);
            const salePrice = parseFloat(document.getElementById('salePrice').value);
            const productCost = parseFloat(document.getElementById('productCost').value);
            const commissionRate = parseFloat(document.getElementById('commission').value);
            
            // Geçerli giriş kontrolü
            if (!productName || productName.trim() === '') {
                showError('Lütfen ürün adını girin.');
                return;
            }
            
            if (isNaN(totalQuantity) || totalQuantity <= 0) {
                showError('Lütfen geçerli bir ürün adedi girin (1 veya daha fazla).');
                return;
            }
            
            if (isNaN(salePrice) || salePrice <= 0) {
                showError('Lütfen geçerli bir satış fiyatı girin.');
                return;
            }
            
            if (isNaN(productCost) || productCost < 0) {
                showError('Lütfen geçerli bir ürün maliyeti girin.');
                return;
            }
            
            if (isNaN(commissionRate) || commissionRate < 0) {
                showError('Lütfen geçerli bir platform komisyon oranı girin.');
                return;
            }
            
            // Gelişmiş değerleri al
            const labelCost = parseFloat(document.getElementById('labelCost').value) || 0;
            const packagingCost = parseFloat(document.getElementById('packagingCost').value) || 0;
            const shippingCost = parseFloat(document.getElementById('shippingCost').value) || 0;
            const adCost = parseFloat(document.getElementById('adCost').value) || 0;
            const platformServiceFee = parseFloat(document.getElementById('platformServiceFee').value) || 0;
            const kdvRate = parseFloat(document.getElementById('kdvRate').value);
            const stopajRate = parseFloat(document.getElementById('stopajRate').value) || 0;
            
            // Kampanya değerleri
            const campaignEnabled = enableCampaignCheckbox.checked;
            let campaignBuy = 3, campaignPay = 2;
            if (campaignEnabled) {
                campaignBuy = parseInt(campaignBuyInput.value) || 3;
                campaignPay = parseInt(campaignPayInput.value) || 2;
                
                if (campaignBuy <= 0 || campaignPay <= 0 || campaignPay > campaignBuy) {
                    showError('Kampanya ayarlarını kontrol edin: Ödenen adet, alınan adetten fazla olamaz.');
                    return;
                }
            }
            
            // Influencer değerleri
            const influencerEnabled = enableInfluencerCheckbox.checked;
            let influencerCommissionRate = 10;
            if (influencerEnabled) {
                influencerCommissionRate = parseFloat(influencerCommissionInput.value) || 10;
                if (influencerCommissionRate < 0) {
                    showError('Influencer komisyon oranı negatif olamaz.');
                    return;
                }
            }
            
            // KAMPANYA HESAPLAMALARI
            let totalProductCostQuantity = totalQuantity; // Maliyet için toplam ürün sayısı
            let totalRevenueQuantity = totalQuantity; // Gelir için toplam ürün sayısı
            let campaignSets = 0;
            let remainingItems = 0;
            
            if (campaignEnabled) {
                // Tüm satışlar kampanyalı olacak
                campaignSets = Math.floor(totalQuantity / campaignBuy);
                remainingItems = totalQuantity % campaignBuy;
                
                // Gelir için: (set sayısı * ödenen adet) + kalanlar (normal fiyat)
                totalRevenueQuantity = (campaignSets * campaignPay) + remainingItems;
                
                // Maliyet için: Tüm ürünler (set sayısı * alınan adet + kalanlar)
                totalProductCostQuantity = (campaignSets * campaignBuy) + remainingItems;
            }
            
            // Hesaplamalar - Birim bazında
            const kdvAmountPerUnit = (salePrice * kdvRate) / 100;
            const salePriceWithoutKdv = salePrice; // KDV'siz fiyat
            const salePriceWithKdv = salePrice + kdvAmountPerUnit; // KDV dahil fiyat
            
            // Stopaj KDV'siz fiyat üzerinden hesaplanır
            const stopajAmountPerUnit = (salePriceWithoutKdv * stopajRate) / 100;
            
            // Platform komisyonu KDV dahil fiyat üzerinden hesaplanır
            const commissionAmountPerUnit = (salePriceWithKdv * commissionRate) / 100;
            
            // Influencer komisyonu (satış fiyatı üzerinden - TÜM SATIŞLAR İÇİN)
            let influencerCommissionAmount = 0;
            if (influencerEnabled) {
                // Tüm satışlar için influencer komisyonu
                influencerCommissionAmount = (salePrice * influencerCommissionRate / 100) * totalQuantity;
            }
            
            // GELİR HESAPLAMALARI
            let totalRevenue = 0;
            
            if (campaignEnabled) {
                // Kampanyalı gelir: (set sayısı * ödenen adet * KDV'li fiyat) + (kalanlar * KDV'li fiyat)
                const campaignRevenue = campaignSets * campaignPay * salePriceWithKdv;
                const remainingRevenue = remainingItems * salePriceWithKdv;
                totalRevenue = campaignRevenue + remainingRevenue;
            } else {
                // Normal gelir
                totalRevenue = totalQuantity * salePriceWithKdv;
            }
            
            // MALİYET HESAPLAMALARI
            // Ürün maliyeti: TÜM ÜRÜNLER için (kampanyada alınan tüm ürünler)
            const totalProductCost = productCost * totalProductCostQuantity;
            const totalLabelCost = labelCost * totalProductCostQuantity; // Tüm ürünler etiketlenir
            const totalPackagingCost = packagingCost * totalProductCostQuantity; // Tüm ürünler paketlenir
            
            const totalCommission = commissionAmountPerUnit * totalRevenueQuantity; // Komisyon ödenen ürünler üzerinden
            const totalStopaj = stopajAmountPerUnit * totalRevenueQuantity; // Stopaj ödenen ürünler üzerinden
            const totalKdv = kdvAmountPerUnit * totalRevenueQuantity; // KDV ödenen ürünler üzerinden
            
            // Toplam maliyet (kargo, reklam ve platform hizmet bedeli tüm sipariş için tek seferlik)
            const totalCost = totalProductCost + totalLabelCost + totalPackagingCost + 
                            totalCommission + totalStopaj + shippingCost + adCost + 
                            influencerCommissionAmount + platformServiceFee;
            
            // Kar/Zarar
            const totalProfit = totalRevenue - totalCost;
            const profitMargin = totalRevenue > 0 ? (totalProfit / totalRevenue) * 100 : 0;
            const unitProfit = totalQuantity > 0 ? totalProfit / totalQuantity : 0;
            const effectivePrice = totalQuantity > 0 ? totalRevenue / totalQuantity : 0;
            
            // Sonuçları göster
            displayResults(
                productName, platform, totalQuantity, 
                salePrice, salePriceWithKdv, salePriceWithoutKdv, productCost, 
                commissionRate, totalCommission, labelCost, totalLabelCost,
                packagingCost, totalPackagingCost, shippingCost, adCost, platformServiceFee,
                kdvRate, totalKdv, stopajRate, totalStopaj,
                totalCost, totalRevenue, totalProfit, profitMargin, unitProfit, effectivePrice,
                campaignEnabled, campaignBuy, campaignPay, totalProductCostQuantity, totalRevenueQuantity, campaignSets, remainingItems,
                influencerEnabled, influencerCommissionRate, influencerCommissionAmount
            );
            
            // Geçmişe ekle
            addToHistory(productName, platform, totalQuantity, totalRevenue, totalProfit, profitMargin, campaignEnabled);
        }

        function displayResults(
            productName, platform, totalQuantity, 
            salePrice, salePriceWithKdv, salePriceWithoutKdv, productCost, 
            commissionRate, totalCommission, labelCost, totalLabelCost,
            packagingCost, totalPackagingCost, shippingCost, adCost, platformServiceFee,
            kdvRate, totalKdv, stopajRate, totalStopaj,
            totalCost, totalRevenue, totalProfit, profitMargin, unitProfit, effectivePrice,
            campaignEnabled, campaignBuy, campaignPay, totalProductCostQuantity, totalRevenueQuantity, campaignSets, remainingItems,
            influencerEnabled, influencerCommissionRate, influencerCommissionAmount
        ) {
            
            const resultDetails = document.getElementById('resultDetails');
            const profitResult = document.getElementById('profitResult');
            const profitAmount = document.getElementById('profitAmount');
            const profitMarginSpan = document.getElementById('profitMargin');
            const unitProfitSpan = document.getElementById('unitProfit');
            const totalWithKdvSpan = document.getElementById('totalWithKdv');
            const effectivePriceSpan = document.getElementById('effectivePrice');
            const breakdownSection = document.getElementById('breakdownSection');
            const breakdownDetails = document.getElementById('breakdownDetails');
            
            // Detaylı sonuç tablosu
            let resultHTML = `
                <div class="cost-summary">
                    <div style="margin-bottom: 15px; font-weight: 600; color: #444;">${productName} - ${platform} (${totalQuantity} adet satış)</div>
                    
                    <div class="cost-item">
                        <span class="cost-title">Toplam Gelir (KDV Dahil)</span>
                        <span class="cost-value">₺${totalRevenue.toFixed(2)}</span>
                    </div>
            `;
            
            // Kampanya bilgisi
            if (campaignEnabled) {
                resultHTML += `
                    <div class="cost-sub-item">
                        <span class="sub-item-title">Toplam Ürün Maliyeti (${totalProductCostQuantity} adet)</span>
                        <span>₺${(productCost * totalProductCostQuantity).toFixed(2)}</span>
                    </div>
                    <div class="cost-sub-item">
                        <span class="sub-item-title">Toplam Gelir Ürünü (${totalRevenueQuantity} adet)</span>
                        <span>${totalRevenueQuantity} adet</span>
                    </div>
                `;
            }
            
            resultHTML += `
                    <div class="cost-sub-item">
                        <span class="sub-item-title">Birim Satış (KDV Dahil)</span>
                        <span>₺${salePriceWithKdv.toFixed(2)}</span>
                    </div>
                    <div class="cost-sub-item">
                        <span class="sub-item-title">KDV (%${kdvRate})</span>
                        <span>₺${totalKdv.toFixed(2)}</span>
                    </div>
                    
                    <div class="cost-item">
                        <span class="cost-title">Ürün Maliyeti (${totalProductCostQuantity} adet)</span>
                        <span class="cost-value">₺${totalProductCost.toFixed(2)}</span>
                    </div>
                    
                    <div class="cost-item">
                        <span class="cost-title">Platform Komisyonu (%${commissionRate})</span>
                        <span class="cost-value">₺${totalCommission.toFixed(2)}</span>
                    </div>
            `;
            
            // Influencer komisyonu
            if (influencerEnabled) {
                resultHTML += `
                    <div class="cost-item">
                        <span class="cost-title">Influencer Komisyonu (%${influencerCommissionRate})</span>
                        <span class="cost-value">₺${influencerCommissionAmount.toFixed(2)}</span>
                    </div>
                    <div class="cost-sub-item">
                        <span class="sub-item-title">Influencer Satış Oranı</span>
                        <span>Tüm satışlar (%100)</span>
                    </div>
                `;
            }
            
            resultHTML += `
                    <div class="cost-item">
                        <span class="cost-title">Etiket Maliyeti (${totalProductCostQuantity} adet)</span>
                        <span class="cost-value">₺${totalLabelCost.toFixed(2)}</span>
                    </div>
                    
                    <div class="cost-item">
                        <span class="cost-title">Paketleme Maliyeti (${totalProductCostQuantity} adet)</span>
                        <span class="cost-value">₺${totalPackagingCost.toFixed(2)}</span>
                    </div>
                    
                    <div class="cost-item">
                        <span class="cost-title">Stopaj (%${stopajRate}, KDV'siz fiyat üzerinden)</span>
                        <span class="cost-value">₺${totalStopaj.toFixed(2)}</span>
                    </div>
                    
                    <div class="cost-item">
                        <span class="cost-title">Kargo Maliyeti (toplam)</span>
                        <span class="cost-value">₺${shippingCost.toFixed(2)}</span>
                    </div>
                    
                    <div class="cost-item">
                        <span class="cost-title">Reklam Gideri (toplam)</span>
                        <span class="cost-value">₺${adCost.toFixed(2)}</span>
                    </div>
                    
                    <div class="cost-item">
                        <span class="cost-title">Platform Hizmet Bedeli (tek sefer)</span>
                        <span class="cost-value">₺${platformServiceFee.toFixed(2)}</span>
                    </div>
                    
                    <div class="cost-item" style="border-top: 2px solid #ddd; padding-top: 15px; font-size: 17px;">
                        <span class="cost-title">Toplam Maliyet</span>
                        <span class="cost-value" style="color: #ef4444;">₺${totalCost.toFixed(2)}</span>
                    </div>
                </div>
            `;
            
            resultDetails.innerHTML = resultHTML;
            
            // Kampanya dağılımı
            if (campaignEnabled) {
                breakdownSection.style.display = 'block';
                const discountPercent = ((campaignBuy - campaignPay) / campaignBuy * 100).toFixed(1);
                
                breakdownDetails.innerHTML = `
                    <div class="breakdown-item">
                        <span>Kampanya:</span>
                        <span>${campaignBuy} al ${campaignPay} öde (%${discountPercent} indirim)</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Toplam Satış:</span>
                        <span>${totalQuantity} adet</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Kampanya Setleri:</span>
                        <span>${campaignSets} set (${campaignSets * campaignBuy} adet)</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Kampanya Dışı Kalan:</span>
                        <span>${remainingItems} adet (normal satış)</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Toplam Maliyet Ürünü:</span>
                        <span>${totalProductCostQuantity} adet (tüm alınan ürünler)</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Toplam Gelir Ürünü:</span>
                        <span>${totalRevenueQuantity} adet (ödenen ürünler)</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Etkili İndirim:</span>
                        <span>%${((salePrice - effectivePrice) / salePrice * 100).toFixed(1)}</span>
                    </div>
                `;
            } else {
                breakdownSection.style.display = 'none';
            }
            
            // Kar/zarar sonucu
            profitResult.style.display = 'block';
            totalWithKdvSpan.textContent = `₺${totalRevenue.toFixed(2)}`;
            unitProfitSpan.textContent = `₺${unitProfit.toFixed(2)}`;
            effectivePriceSpan.textContent = `₺${effectivePrice.toFixed(2)}`;
            
            if (totalProfit > 0) {
                profitAmount.textContent = `₺${totalProfit.toFixed(2)} KAR`;
                profitAmount.className = 'profit-positive';
                profitResult.style.backgroundColor = '#f0fdf4';
                profitResult.style.borderColor = '#bbf7d0';
            } else if (totalProfit < 0) {
                profitAmount.textContent = `₺${Math.abs(totalProfit).toFixed(2)} ZARAR`;
                profitAmount.className = 'profit-negative';
                profitResult.style.backgroundColor = '#fef2f2';
                profitResult.style.borderColor = '#fecaca';
            } else {
                profitAmount.textContent = '₺0.00';
                profitAmount.className = 'profit-neutral';
                profitResult.style.backgroundColor = '#f9fafc';
                profitResult.style.borderColor = '#d1d5db';
            }
            
            profitMarginSpan.textContent = `%${profitMargin.toFixed(2)}`;
        }

        function addToHistory(productName, platform, quantity, totalRevenue, profit, profitMargin, hasCampaign) {
            const historyList = document.getElementById('historyList');
            
            // İlk mesajı kaldır
            if (historyList.querySelector('p')) {
                historyList.innerHTML = '';
            }
            
            // Yeni geçmiş öğesi oluştur
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            
            const profitClass = profit > 0 ? 'profit-positive-sm' : (profit < 0 ? 'profit-negative-sm' : '');
            const profitText = profit > 0 ? `+₺${profit.toFixed(2)}` : (profit < 0 ? `-₺${Math.abs(profit).toFixed(2)}` : '₺0.00');
            
            let campaignBadge = '';
            if (hasCampaign) {
                campaignBadge = '<span style="background: #4caf50; color: white; padding: 2px 6px; border-radius: 10px; font-size: 11px; margin-left: 5px;">Kampanyalı</span>';
            }
            
            historyItem.innerHTML = `
                <div class="history-product">${productName} ${campaignBadge}</div>
                <div class="history-platform">${platform} - ${quantity} adet - ₺${totalRevenue.toFixed(2)}</div>
                <div class="history-profit ${profitClass}">${profitText} (%${profitMargin.toFixed(2)})</div>
                <div style="clear:both;"></div>
            `;
            
            // En üste ekle
            historyList.prepend(historyItem);
            
            // En fazla 15 öğe tut
            const items = historyList.querySelectorAll('.history-item');
            if (items.length > 15) {
                items[items.length - 1].remove();
            }
            
            // Geçmişi localStorage'a kaydet
            saveHistoryToLocal();
        }

        function resetForm() {
            document.getElementById('productName').value = '';
            document.getElementById('quantity').value = '1';
            document.getElementById('salePrice').value = '';
            document.getElementById('productCost').value = '';
            document.getElementById('commission').value = platformCommissions.trendyol;
            
            // Kampanya
            enableCampaignCheckbox.checked = false;
            campaignInputs.style.display = 'none';
            campaignCalculation.style.display = 'none';
            campaignBuyInput.value = '3';
            campaignPayInput.value = '2';
            
            // Influencer
            enableInfluencerCheckbox.checked = false;
            influencerInputs.style.display = 'none';
            influencerCommissionInput.value = '10';
            
            // Diğer
            document.getElementById('labelCost').value = '0.50';
            document.getElementById('packagingCost').value = '2.00';
            document.getElementById('shippingCost').value = '15.00';
            document.getElementById('adCost').value = '0.00';
            document.getElementById('platformServiceFee').value = '0.00';
            document.getElementById('kdvRate').value = '1';
            document.getElementById('stopajRate').value = '10';
            
            document.getElementById('resultDetails').innerHTML = '<p>Lütfen ürün bilgilerini girin ve "Hesapla" butonuna tıklayın.</p>';
            document.getElementById('profitResult').style.display = 'none';
            document.getElementById('breakdownSection').style.display = 'none';
            advancedSection.style.display = 'none';
            toggleText.textContent = '▼ Diğer Maliyetleri Göster';
        }

        function clearHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '<p>Henüz hesaplama yapılmadı.</p>';
            
            // LocalStorage'dan da temizle
            localStorage.removeItem('ecommerceProfitHistory');
        }

        function saveHistoryToLocal() {
            const historyList = document.getElementById('historyList');
            const items = historyList.querySelectorAll('.history-item');
            const historyData = [];
            
            items.forEach(item => {
                const product = item.querySelector('.history-product').textContent;
                const platformText = item.querySelector('.history-platform').textContent;
                const profitText = item.querySelector('.history-profit').textContent;
                
                historyData.push({
                    product: product,
                    platform: platformText,
                    profit: profitText
                });
            });
            
            localStorage.setItem('ecommerceProfitHistory', JSON.stringify(historyData));
        }

        function loadHistoryFromLocal() {
            const historyData = localStorage.getItem('ecommerceProfitHistory');
            const historyList = document.getElementById('historyList');
            
            if (historyData) {
                const history = JSON.parse(historyData);
                historyList.innerHTML = '';
                
                history.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    // Profit class'ını belirle
                    let profitClass = '';
                    if (item.profit.includes('+')) profitClass = 'profit-positive-sm';
                    else if (item.profit.includes('-')) profitClass = 'profit-negative-sm';
                    
                    historyItem.innerHTML = `
                        <div class="history-product">${item.product}</div>
                        <div class="history-platform">${item.platform}</div>
                        <div class="history-profit ${profitClass}">${item.profit}</div>
                        <div style="clear:both;"></div>
                    `;
                    
                    historyList.appendChild(historyItem);
                });
            }
        }

        // Sayfa yüklendiğinde
        window.onload = function() {
            // Varsayılan komisyonu ayarla
            commissionInput.value = platformCommissions.trendyol;
            
            // Kampanya detaylarını güncelle
            updateCampaignDetails();
            
            // Geçmişi yükle
            loadHistoryFromLocal();
        };
    </script>
</body>
</html>